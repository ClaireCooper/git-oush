#!/usr/bin/env bash

SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )
SOUNDS_DIR="$SCRIPT_DIR"/../share/misc/git-oush
SOUND_FILES=$(ls $SOUNDS_DIR)

GAIN=0

# update gain
while [[ $# -gt 0 ]]; do
  case $1 in
    -pp)
      GAIN=$((GAIN-20))
      shift
      ;;
    -p)
      GAIN=$((GAIN-10))
      shift
      ;;
    -mp)
      GAIN=$((GAIN-5))
      shift
      ;;
    -mf)
      GAIN=$((GAIN+5))
      shift
      ;;
    -f|--force)
      GAIN=$((GAIN+10))
      shift
      ;;
    -ff)
      GAIN=$((GAIN+20))
      shift
      ;;
    --paddy)
      SOUND_FILES=$(echo "$SOUND_FILES" | grep paddy)
      shift
      ;;
    --matilda)
      SOUND_FILES=$(echo "$SOUND_FILES" | grep matilda)
      shift
      ;;
    *)
      shift
      ;;
  esac
done

if [ -z "$SOUND_FILES" ]; then
  SOUND_FILES=$(ls $SOUNDS_DIR)
fi

SOUND_FILE=$(echo "$SOUND_FILES" | shuf -n 1)
sox "$SOUNDS_DIR"/"$SOUND_FILE" -t wav - gain $GAIN 2>/dev/null | aplay --quiet
